{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RSS Dashboard - MCS</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #fd7e14;
        --dark-orange: #e06c0c;
        --sidebar-bg: #fff3e6;
        --sidebar-active: #fd7e14;
        --sidebar-link: #fd7e14;
        --sidebar-link-hover: #ffe0b3;
      }

      body {
        background-color: #ffffff;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Navbar Styles */
      .navbar {
        background-color: var(--primary-color) !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .navbar-brand img {
        height: 40px;
      }

      /* Sidebar Styles */
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: 250px;
        background-color: var(--sidebar-bg);
        padding-top: 60px;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 2px 0 8px rgba(0, 0, 0, 0.04);
      }

      .sidebar.collapsed {
        left: -250px;
      }

      .sidebar .nav-link {
        color: var(--primary-color);
        padding: 0.8rem 1rem;
        transition: all 0.3s ease;
        border-radius: 6px;
        margin: 0.2rem 0.5rem;
        font-weight: 500;
      }

      .sidebar .nav-link:hover {
        background-color: var(--sidebar-link-hover);
        color: var(--dark-orange);
      }

      .sidebar .nav-link.active {
        background-color: var(--primary-color);
        color: #fff;
      }

      .sidebar .nav-link i {
        width: 25px;
        text-align: center;
        margin-right: 10px;
      }

      /* Main Content */
      .main-content {
        margin-left: 250px;
        padding: 2rem;
        flex: 1;
      }

      /* Footer */
      .footer {
        background-color: var(--dark-orange);
        color: white;
        margin-top: auto;
        padding: 1rem 0;
        margin-left: 250px;
      }

      .footer a {
        color: white;
        text-decoration: none;
      }

      .footer a:hover {
        text-decoration: underline;
      }

      /* Button Styles */
      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .btn-primary:hover {
        background-color: var(--dark-orange);
        border-color: var(--dark-orange);
      }

      .btn-outline-primary {
        color: var(--primary-color);
        border-color: var(--primary-color);
      }

      .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
      }

      .text-primary {
        color: var(--primary-color) !important;
      }

      /* Card Styles */
      .card {
        border: 1px solid rgba(253, 126, 20, 0.1);
        box-shadow: 0 4px 12px rgba(253, 126, 20, 0.08);
        transition: all 0.3s ease;
      }

      .card:hover {
        box-shadow: 0 6px 16px rgba(253, 126, 20, 0.12);
        transform: translateY(-2px);
      }

      .card-header {
        background-color: #ffffff;
        border-bottom: 1px solid rgba(253, 126, 20, 0.1);
        padding: 1.25rem 1.5rem;
      }

      .card-body {
        padding: 1.5rem;
      }

      /* Calculator Card Specific Styles */
      .card .form-label {
        color: var(--dark-orange);
        font-weight: 500;
      }

      .card .form-control:focus,
      .card .form-select:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(253, 126, 20, 0.15);
      }

      .card .input-group-text {
        background-color: rgba(253, 126, 20, 0.05);
        border-color: rgba(253, 126, 20, 0.1);
        color: var(--primary-color);
      }

      /* Progress Section Styles */
      .progress-section {
        background-color: #ffffff;
        padding: 1.25rem;
        border-radius: 8px;
        margin-top: 1rem;
        border: 1px solid rgba(253, 126, 20, 0.1);
        box-shadow: 0 2px 8px rgba(253, 126, 20, 0.05);
      }

      .progress {
        background-color: rgba(253, 126, 20, 0.1);
        border-radius: 10px;
        height: 8px;
      }

      .progress-bar {
        background-color: var(--primary-color);
        transition: width 0.6s ease;
      }

      /* Stats Card Specific Styles */
      .card .fa-2x {
        opacity: 0.9;
      }

      .card .text-primary {
        color: var(--primary-color) !important;
      }

      .card .text-info {
        color: var(--dark-orange) !important;
      }

      @media (max-width: 768px) {
        .sidebar {
          left: -250px;
        }
        .sidebar.show {
          left: 0;
        }
        .main-content,
        .footer {
          margin-left: 0;
        }
      }

      /* Toggle Button for Mobile */
      .sidebar-toggle {
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 1001;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: 4px;
        padding: 0.5rem;
        display: none;
      }

      @media (max-width: 768px) {
        .sidebar-toggle {
          display: block;
        }
      }

      /* Icon Colors */
      .text-success {
        color: var(--primary-color) !important;
      }

      .text-info {
        color: var(--dark-orange) !important;
      }

      .timeline-indicators {
        font-size: 0.75rem;
        color: var(--dark-orange);
      }
    </style>
  </head>
  <body>
    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle d-lg-none" id="sidebarToggle">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
      <div class="container">
        <div class="d-flex justify-content-center w-100 d-lg-none">
          <a class="navbar-brand" href="{% url 'home' %}">
            <img
              src="{% static 'tgfs/images/tgfs.png' %}"
              alt="MCS Logo"
              height="40"
            />
          </a>
        </div>
        <a class="navbar-brand d-none d-lg-block" href="{% url 'home' %}">
          <img
            src="{% static 'tgfs/images/tgfs.png' %}"
            alt="MCS Logo"
            height="40"
          />
        </a>
        <button
          class="navbar-toggler position-absolute start-0"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-end"
          id="navbarNav"
        >
          <div class="navbar-nav">
            <span class="nav-item nav-link text-light"
              >Welcome, {{ user.username }}</span
            >
            <form action="{% url 'logout' %}" method="post" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-outline-light">
                Logout
              </button>
            </form>
          </div>
        </div>
      </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="d-flex flex-column h-100">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="{% url 'rss_dashboard' %}">
              <i class="fas fa-chart-line"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'rss_portfolio' %}">
              <i class="fas fa-chart-pie"></i>My Portfolio
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'rss_emergency_funds' %}">
              <i class="fas fa-shield-alt"></i>Emergency Funds
            </a>
          </li>
          <li class="nav-item mt-auto">
            <a class="nav-link" href="{% url 'home' %}">
              <i class="fas fa-home"></i>Back to Home
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Dashboard Header -->
      <header class="dashboard-header mb-4">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h1 class="display-5 fw-bold">Retirement Savings Scheme</h1>
              <p class="lead text-muted">
                Secure your future with our comprehensive retirement savings
                program
              </p>
            </div>
            <div class="col-md-4 text-md-end">
              <a href="{% url 'home' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left"></i> Back to Main Dashboard
              </a>
            </div>
          </div>
        </div>
      </header>

      <!-- Quick Stats -->
      <div class="container">
        <div class="row g-4 mb-4">
          <!-- Total Savings -->
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h5 class="card-title mb-0">Total Savings</h5>
                  <i class="fas fa-piggy-bank text-primary fa-2x"></i>
                </div>
                <h3 class="mb-0">$0.00</h3>
                <p class="text-muted mb-0">Current balance</p>
              </div>
            </div>
          </div>

          <!-- Monthly Contribution -->
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h5 class="card-title mb-0">Contribution Progress</h5>
                  <i class="fas fa-hand-holding-usd text-success fa-2x"></i>
                </div>

                <!-- 10-Year Progress -->
                <div class="progress-section">
                  <div
                    class="d-flex justify-content-between align-items-center mb-2"
                  >
                    <small class="text-muted">10-Year Savings Progress</small>
                    <small class="text-primary fw-bold">0/10 Years</small>
                  </div>
                  <div class="progress mb-2" style="height: 8px">
                    <div
                      class="progress-bar bg-primary"
                      role="progressbar"
                      style="width: 0%"
                      aria-valuenow="0"
                      aria-valuemin="0"
                      aria-valuemax="100"
                    ></div>
                  </div>
                  <div
                    class="timeline-indicators d-flex justify-content-between"
                  >
                    <small class="text-muted">Start</small>
                    <small class="text-muted">5 Years</small>
                    <small class="text-muted">10 Years</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Investment Returns -->
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
              <div class="card-body">
                <div
                  class="d-flex justify-content-between align-items-center mb-3"
                >
                  <h5 class="card-title mb-0">Investment Returns</h5>
                  <i class="fas fa-chart-line text-info fa-2x"></i>
                </div>
                <h3 class="mb-0">0.00%</h3>
                <p class="text-muted mb-0">Year to date</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="row g-4">
          <!-- Investment Portfolio -->
          <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white">
                <h5 class="card-title mb-0">Investment Portfolio</h5>
              </div>
              <div class="card-body">
                <div class="text-center py-5">
                  <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                  <h5>No investments yet</h5>
                  <p class="text-muted">Start your investment journey today</p>
                  <a href="{% url 'rss_portfolio' %}" class="btn btn-primary"
                    >View Portfolio</a
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Compound Interest Calculator -->
          <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white">
                <h5 class="card-title mb-0">Compound Interest Calculator</h5>
              </div>
              <div class="card-body">
                <form id="compoundCalculator">
                  <!-- Initial Investment -->
                  <div class="mb-3">
                    <label class="form-label d-flex align-items-center">
                      Initial Investment
                      <button
                        type="button"
                        class="btn btn-link btn-sm p-0 ms-2"
                        data-bs-toggle="tooltip"
                        data-bs-placement="right"
                        title="The amount of money you start with. This is your initial deposit into the investment."
                      >
                        <i class="fas fa-info-circle text-primary"></i>
                      </button>
                    </label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input
                        type="number"
                        class="form-control"
                        id="initialInvestment"
                        min="0"
                        step="100"
                        placeholder="Enter initial amount"
                      />
                    </div>
                  </div>

                  <!-- Regular Addition -->
                  <div class="mb-3">
                    <label class="form-label d-flex align-items-center">
                      Regular Addition
                      <button
                        type="button"
                        class="btn btn-link btn-sm p-0 ms-2"
                        data-bs-toggle="tooltip"
                        data-bs-placement="right"
                        title="The amount you plan to add regularly to your investment. This could be weekly, monthly, quarterly, or yearly contributions."
                      >
                        <i class="fas fa-info-circle text-primary"></i>
                      </button>
                    </label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input
                        type="number"
                        class="form-control"
                        id="regularAddition"
                        min="0"
                        step="10"
                        placeholder="Enter regular addition"
                      />
                      <select
                        class="form-select"
                        id="additionFrequency"
                        style="max-width: 120px"
                      >
                        <option value="weekly">Weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="yearly">Yearly</option>
                      </select>
                    </div>
                  </div>

                  <!-- Interest Rate -->
                  <div class="mb-3">
                    <label class="form-label d-flex align-items-center">
                      Interest Rate
                      <button
                        type="button"
                        class="btn btn-link btn-sm p-0 ms-2"
                        data-bs-toggle="tooltip"
                        data-bs-placement="right"
                        title="The annual interest rate you expect to earn on your investment. This is the percentage return you anticipate. Default is set to 12.7% but you can adjust it."
                      >
                        <i class="fas fa-info-circle text-primary"></i>
                      </button>
                    </label>
                    <div class="input-group mb-2">
                      <input
                        type="number"
                        class="form-control"
                        id="interestRate"
                        min="0"
                        max="30"
                        step="0.1"
                        value="12.7"
                        placeholder="Enter interest rate"
                      />
                      <span class="input-group-text">%</span>
                    </div>
                    <input
                      type="range"
                      class="form-range"
                      id="interestRateSlider"
                      min="0"
                      max="30"
                      step="0.1"
                      value="12.7"
                      oninput="updateInterestRate(this.value)"
                    />
                    <div class="d-flex justify-content-between mt-1">
                      <small class="text-muted">0%</small>
                      <small class="text-muted">30%</small>
                    </div>
                  </div>

                  <!-- Compounding Frequency -->
                  <div class="mb-3">
                    <label class="form-label d-flex align-items-center">
                      Compounding Frequency
                      <button
                        type="button"
                        class="btn btn-link btn-sm p-0 ms-2"
                        data-bs-toggle="tooltip"
                        data-bs-placement="right"
                        title="How often the interest is calculated and added to your investment. More frequent compounding (e.g., daily) generally results in higher returns."
                      >
                        <i class="fas fa-info-circle text-primary"></i>
                      </button>
                    </label>
                    <select class="form-select" id="compoundingFrequency">
                      <option value="daily">Daily</option>
                      <option value="weekly">Weekly</option>
                      <option value="monthly">Monthly</option>
                      <option value="quarterly">Quarterly</option>
                      <option value="yearly" selected>Yearly</option>
                    </select>
                  </div>

                  <!-- Years to Grow -->
                  <div class="mb-4">
                    <label class="form-label d-flex align-items-center">
                      Years to Grow
                      <button
                        type="button"
                        class="btn btn-link btn-sm p-0 ms-2"
                        data-bs-toggle="tooltip"
                        data-bs-placement="right"
                        title="The number of years you plan to keep your investment. Longer periods generally result in higher returns due to compound interest."
                      >
                        <i class="fas fa-info-circle text-primary"></i>
                      </button>
                    </label>
                    <div class="input-group">
                      <input
                        type="number"
                        class="form-control"
                        id="yearsToGrow"
                        min="1"
                        max="50"
                        step="1"
                        placeholder="Enter years"
                      />
                      <span class="input-group-text">years</span>
                    </div>
                  </div>

                  <!-- Calculate Button -->
                  <button type="submit" class="btn btn-primary w-100">
                    Calculate Returns
                  </button>
                </form>

                <!-- Results Section (Hidden by default) -->
                <div id="calculationResults" class="mt-4 d-none">
                  <hr />
                  <h6 class="mb-3">Projected Results</h6>
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Total Investment:</span>
                    <span class="fw-bold" id="totalInvestment">$0.00</span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Interest Earned:</span>
                    <span class="fw-bold" id="interestEarned">$0.00</span>
                  </div>
                  <div class="d-flex justify-content-between">
                    <span class="text-muted">Final Amount:</span>
                    <span class="fw-bold text-primary" id="finalAmount"
                      >$0.00</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <p class="mb-0">
              &copy; 2024 Mushana Multipurpose Cooperative Society. All rights
              reserved.
            </p>
          </div>
          <div class="col-md-6 text-md-end">
            <a href="#" class="me-3">Privacy Policy</a>
            <a href="#">Contact Us</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Sidebar Toggle Script -->
    <script>
      document
        .getElementById("sidebarToggle")
        .addEventListener("click", function () {
          document.getElementById("sidebar").classList.toggle("show");
        });
    </script>
    <!-- Add this before the closing body tag -->
    <script>
      // Initialize all tooltips
      var tooltipTriggerList = [].slice.call(
        document.querySelectorAll('[data-bs-toggle="tooltip"]')
      );
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });

      // Handle form submission
      document
        .getElementById("compoundCalculator")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Get form values
          const initialInvestment =
            parseFloat(document.getElementById("initialInvestment").value) || 0;
          const regularAddition =
            parseFloat(document.getElementById("regularAddition").value) || 0;
          const interestRate =
            parseFloat(document.getElementById("interestRate").value) || 0;
          const yearsToGrow =
            parseInt(document.getElementById("yearsToGrow").value) || 0;
          const compoundingFrequency = document.getElementById(
            "compoundingFrequency"
          ).value;
          const additionFrequency =
            document.getElementById("additionFrequency").value;

          // Calculate compound interest
          const r = interestRate / 100; // Convert percentage to decimal
          const n = getCompoundingPeriods(compoundingFrequency);
          const t = yearsToGrow;
          const pmt =
            regularAddition *
            getAdditionMultiplier(additionFrequency, compoundingFrequency);

          // Compound interest formula
          const finalAmount =
            initialInvestment * Math.pow(1 + r / n, n * t) +
            pmt * ((Math.pow(1 + r / n, n * t) - 1) / (r / n));

          // Calculate total investment
          const totalInvestment =
            initialInvestment +
            regularAddition *
              getAdditionMultiplier(additionFrequency, "yearly") *
              yearsToGrow;
          const interestEarned = finalAmount - totalInvestment;

          // Update results
          document.getElementById("totalInvestment").textContent =
            formatCurrency(totalInvestment);
          document.getElementById("interestEarned").textContent =
            formatCurrency(interestEarned);
          document.getElementById("finalAmount").textContent =
            formatCurrency(finalAmount);

          // Show results
          document
            .getElementById("calculationResults")
            .classList.remove("d-none");
        });

      // Helper functions
      function getCompoundingPeriods(frequency) {
        const periods = {
          daily: 365,
          weekly: 52,
          monthly: 12,
          quarterly: 4,
          yearly: 1,
        };
        return periods[frequency] || 12;
      }

      function getAdditionMultiplier(additionFreq, compoundingFreq) {
        const yearlyMultiplier = {
          weekly: 52,
          monthly: 12,
          quarterly: 4,
          yearly: 1,
        };
        return yearlyMultiplier[additionFreq] || 12;
      }

      function formatCurrency(amount) {
        return new Intl.NumberFormat("en-US", {
          style: "currency",
          currency: "USD",
        }).format(amount);
      }

      // Add this to your existing script
      function updateInterestRate(value) {
        document.getElementById("interestRate").value = value;
        // Trigger calculation if form is already filled
        if (document.getElementById("initialInvestment").value) {
          document
            .getElementById("compoundCalculator")
            .dispatchEvent(new Event("submit"));
        }
      }

      // Add this to your existing script
      document
        .getElementById("interestRate")
        .addEventListener("input", function (e) {
          document.getElementById("interestRateSlider").value = e.target.value;
          // Trigger calculation if form is already filled
          if (document.getElementById("initialInvestment").value) {
            document
              .getElementById("compoundCalculator")
              .dispatchEvent(new Event("submit"));
          }
        });
    </script>
  </body>
</html>
